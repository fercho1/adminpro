{"version":3,"file":"watcher-helper.js","sources":["watcher-helper.ts"],"names":[],"mappings":"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","sourcesContent":["/*!\n * devextreme-angular\n * Version: 19.1.11\n * Build date: Fri May 15 2020\n *\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\n *\n * This software may be modified and distributed under the terms\n * of the MIT license. See the LICENSE file in the root of the project for details.\n *\n * https://github.com/DevExpress/devextreme-angular\n */\n\nimport {\r\n    Injectable\r\n} from '@angular/core';\r\n\r\nimport * as commonUtils from 'devextreme/core/utils/common';\r\n\r\n@Injectable()\r\nexport class WatcherHelper {\r\n    private _watchers: any[] = [];\r\n\r\n    getWatchMethod() {\r\n        let watchMethod = (valueGetter, valueChangeCallback, options) => {\r\n            let oldValue = valueGetter();\r\n            options = options || {};\r\n\r\n            if (!options.skipImmediate) {\r\n                valueChangeCallback(oldValue);\r\n            }\r\n\r\n            let watcher = () => {\r\n                let newValue = valueGetter();\r\n\r\n                if (this._isDifferentValues(oldValue, newValue, options.deep)) {\r\n                    valueChangeCallback(newValue);\r\n                    oldValue = newValue;\r\n                }\r\n            };\r\n\r\n            this._watchers.push(watcher);\r\n\r\n            return () => {\r\n                let index = this._watchers.indexOf(watcher);\r\n\r\n                if (index !== -1) {\r\n                    this._watchers.splice(index, 1);\r\n                }\r\n            };\r\n        };\r\n\r\n        return watchMethod;\r\n    }\r\n\r\n    private _isDifferentValues(oldValue: any, newValue: any, deepCheck: boolean) {\r\n        let comparableNewValue = this._toComparable(newValue);\r\n        let comparableOldValue = this._toComparable(oldValue);\r\n        let isObjectValues = comparableNewValue instanceof Object && comparableOldValue instanceof Object;\r\n\r\n        if (deepCheck && isObjectValues) {\r\n            return this._checkObjectsFields(newValue, oldValue);\r\n        }\r\n        return comparableNewValue !== comparableOldValue;\r\n    }\r\n\r\n    private _toComparable(value) {\r\n        if (value instanceof Date) {\r\n            return value.getTime();\r\n        }\r\n\r\n        return value;\r\n    }\r\n\r\n    private _checkObjectsFields(checkingFromObject: Object, checkingToObject: Object) {\r\n        for (let field in checkingFromObject) {\r\n            let oldValue = this._toComparable(checkingFromObject[field]);\r\n            let newValue = this._toComparable(checkingToObject[field]);\r\n            let isEqualObjects = false;\r\n\r\n            if (typeof oldValue === 'object' && typeof newValue === 'object') {\r\n                isEqualObjects = commonUtils.equalByValue(oldValue, newValue);\r\n            }\r\n            if (oldValue !== newValue && !isEqualObjects) {\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n\r\n    checkWatchers() {\r\n       for (let watcher of this._watchers) {\r\n            watcher();\r\n        }\r\n    }\r\n}\r\n"]}